@page "/UserLogin"
@using DatingApp.Repository
@using DatingApp.Models
@inject UserRepository repo
@inject NavigationManager NM
@inject Login login

<h3>Login</h3>

<EditForm Model="@login" OnValidSubmit="LoginUser">
    <DataAnnotationsValidator/>
    <ValidationSummary/>
    <InputText @bind-Value="login.Username" placeholder ="User name"></InputText>
    <InputText @bind-Value="login.Password1" placeholder="Password" typeof="password"></InputText>
    <button type="submit">Login</button>
    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <p class="text-danger">@errorMessage</p>
    }
</EditForm>

@code {
    private string errorMessage = "";
    private void LoginUser()
    {
        User user = repo.GetUserByUsername(login.Username);
        if(user!=null && user.Password1 == login.Password1)
        {
            NM.NavigateTo("");
        }
        else
        {
            errorMessage = "Invalid username or Password. Please try again";
        }
    }
}
