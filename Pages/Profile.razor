@*Razor page for displaying a user profile*@
@page "//Profile"
@using DatingApp.Models
@using DatingApp.Repository
@using DatingApp.Service
@inject NavigationManager NM
@inject UserRepository repo
@inject UserProfile UserProfile
@inject AuthenticationService authService

<h3>Profile</h3>

<p>Username: @UserProfile.Username</p>
<p>Fullname: @UserProfile.Fullname</p>
<p>Brithdate: @UserProfile.Brithdate.ToShortDateString()</p>
<p>Height: @UserProfile.Height</p>
<p>About me: @UserProfile.Aboutme</p>
<p>City: @repo.GetcityName(UserProfile.Cityid)</p>
<p>Gender: @repo.GetGenderName(UserProfile.Genderid)</p>

<h3>Likes Recived</h3>
@foreach(var like in repo.GetLikesReceived(UserProfile.UserId))
{
    <p>@like.Username</p>
}
<button @onclick="SendLike">Send Like</button>
<button @onclick="()=>NavigateToEditProfile(true)">Edit Profile</button>
<button @onclick="Logout">Logout</button>

@*Code block for handling Profile page*@
@code{
    protected override void OnInitialized()
    {
        int loggedInUser = authService.LoggedInUser?.UserId ?? 0;
        UserProfile = repo.GetUserProfile(loggedInUser);
    }
    private void NavigateToEditProfile(bool IsEditMode)
    {
        NM.NavigateTo($"/CreateProfile/{UserProfile.UserId}?edit={IsEditMode}");
    }
    private void Logout()
    {
        authService.logout();
        NM.NavigateTo("/UserLogin");
    }
    private void SendLike()
    {
        repo.AddLike(authService.LoggedInUser.UserId, UserProfile.UserId);
    }
}